<header class="modern-navbar">
  <div class="navbar-container">

    <!-- Left Section: Logo/Brand -->
    <div class="navbar-left">
      <button *ngIf="shouldShowToggle" class="sidebar-toggle-btn" (click)="toggleSidebar()">
        <mat-icon>{{ sidebarOpen ? 'menu_open' : 'menu' }}</mat-icon>
      </button>

      <div class="logo-container" (click)="navigateToDashboard()">
        <img src="../../../assets/images/Vector.svg" alt="Legal Assistance System Logo" class="header-logo" />
        <span class="app-title">{{label.COMMON.LEGAL_ASSISTANCE_SYSTEM}}</span>
      </div>
    </div>

    <!-- Center Section: Search -->
    <div class="navbar-center">
      <div class="search-wrapper-container">
        <!-- Enhanced Search Input with better UX -->
        <div class="search-input-wrapper">
          <mat-icon class="search-prefix-icon">search</mat-icon>

          <input 
            type="text" 
            class="search-input" 
            [(ngModel)]="params.search" 
            [ngModelOptions]="{standalone: true}"
            [placeholder]="label.COMMON.MASTER_SEARCH_PLACEHLDER || 'Search persons, companies, properties...'"
            (keyup)="onSearch()"
            (keyup.enter)="onSearch()"
            (focus)="showSearchMenu()"
            #searchInput
            autocomplete="off">

          <!-- Clear Button -->
          <button 
            *ngIf="params.search" 
            class="search-clear-btn"
            mat-icon-button
            type="button"
            (click)="clearSearch(); $event.stopPropagation()"
            [attr.aria-label]="'Clear search'">
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <!-- Redesigned Search Results Dropdown -->
        <div class="search-results-dropdown" *ngIf="showSearchResults && params.search">
          
          <!-- Loading State with better styling -->
          <div *ngIf="isSearching" class="search-loading">
            <div class="loading-content">
              <mat-progress-spinner diameter="28" mode="indeterminate" color="primary"></mat-progress-spinner>
              <span>{{ label.COMMON.LOADING || 'Loading...' }}</span>
            </div>
          </div>

          <!-- No Results State -->
          <div *ngIf="!isSearching && searchResults.length === 0" class="no-results-state">
            <div class="empty-state-content">
              <mat-icon>search_off</mat-icon>
              <p class="empty-title">{{ label.COMMON.NO_RESULTS_FOUND || 'No results found' }}</p>
              <p class="empty-hint">Try different keywords or filters</p>
            </div>
          </div>

          <!-- Search Results List with improved styling -->
          <div *ngIf="searchResults.length > 0" class="search-results-list">
            <!-- Results Header -->
            <div class="results-header">
              <span class="results-count">{{ searchResults.length }} results</span>
            </div>

            <!-- Results Items with better organization -->
            <button 
              class="search-result-item"
              type="button"
              *ngFor="let result of searchResults | slice:0:10"
              (click)="openEntity(result)"
              [attr.aria-label]="result.entityCode + ' - ' + result.entityType">
              <div class="result-icon-wrapper">
                <div class="result-icon">
                  <mat-icon>{{ getEntityIcon(result.entityIdc) }}</mat-icon>
                </div>
              </div>
              <div class="result-content">
                <div class="result-main">
                  @if(!result.fullName){
                    <span class="result-code">{{ result.entityCode }}</span>
                  }@else {
                    <span class="result-fullname">{{ result.fullName }} ({{ result.entityCode }})</span>
                  }
                  <span class="result-type-badge">{{ result.entityType }}</span>
                </div>
              </div>
              <mat-icon class="result-arrow">arrow_forward</mat-icon>
            </button>

            <!-- Load More Button -->
            <ng-container *ngIf="hasMoreResults">
              <button 
                class="load-more-btn"
                type="button"
                (click)="loadMore($event)"
                [disabled]="isLoadingMore">
                <ng-container *ngIf="!isLoadingMore">
                  <span>{{ label.COMMON.LOAD_MORE || 'Load More' }}</span>
                  <mat-icon>expand_more</mat-icon>
                </ng-container>
                <ng-container *ngIf="isLoadingMore">
                  <mat-progress-spinner diameter="14" strokeWidth="2" mode="indeterminate" color="primary"></mat-progress-spinner>
                  <span>Loading...</span>
                </ng-container>
              </button>
            </ng-container>
          </div>
        </div>
      </div>

      <!-- Quick Create Button -->
      <button 
        class="create-button" 
        [matMenuTriggerFor]="listToCreate_menu"
        [attr.aria-label]="label.COMMON.ADD || 'Add'">
        <mat-icon>add</mat-icon>
        <span>{{ label.COMMON.ADD }}</span>
      </button>
    </div>

    <!-- Right Section: User Controls -->
    <div class="navbar-right">
      <div class="control-item">
        <button class="control-button user-profile" [matMenuTriggerFor]="profile" #profileButton>
          <div class="avatar-container">
            <div class="avatar-badge">
              <mat-icon class="avatar-icon">account_circle</mat-icon>
              <span class="online-indicator"></span>
            </div>
          </div>
          <div class="user-info">
            <span class="username">{{user?.firstName}} {{user?.lastName}}</span>
            <!-- <span class="user-role">{{user?.role || 'User'}}</span> -->
          </div>
          <mat-icon class="dropdown-icon">expand_more</mat-icon>
        </button>
      </div>
    </div>

  </div>
</header>

<!-- Create Menu -->
<mat-menu #listToCreate_menu="matMenu" class="create-menu">
  <button mat-menu-item *ngFor="let item of listToCreated" (click)="openAddDialog(item)">
    <mat-icon>{{item.icon}}</mat-icon>
    <span>{{ item.name }}</span>
  </button>
</mat-menu>

<!-- Profile Menu -->
<mat-menu #profile="matMenu" class="profile-menu" [hasBackdrop]="true">
  <!-- Profile Header Section -->
  <div class="profile-menu-header" mat-menu-item disabled>
    <div class="profile-header-content">
      <div class="profile-avatar-large">
        <mat-icon>account_circle</mat-icon>
        <span class="online-indicator-large"></span>
      </div>
      <div class="profile-user-details">
        <span class="profile-username">{{user?.userName}}</span>
        <!-- <span class="profile-role">{{user?.role || 'User'}}</span> -->
        <span class="profile-email">{{user?.email || 'user@las.com'}}</span>
      </div>
    </div>
  </div>

  <mat-divider class="profile-divider"></mat-divider>



  <!-- Language & Preferences Section -->
  <div class="profile-section">
    <span class="section-label">Preferences</span>
    <button mat-menu-item [matMenuTriggerFor]="languages_menu" class="profile-menu-item">
      <mat-icon>language</mat-icon>
      <span>Language: {{selectedLanguage.name}}</span>
      <mat-icon class="item-arrow">arrow_forward</mat-icon>
    </button>
  </div>

  <mat-divider class="profile-divider"></mat-divider>

  <!-- Logout Section -->
  <button mat-menu-item (click)="logout()" class="profile-menu-item logout-item">
    <mat-icon>logout</mat-icon>
    <span>Sign Out</span>
    <mat-icon class="item-arrow">arrow_forward</mat-icon>
  </button>
</mat-menu>

<!-- Language Menu -->
<mat-menu #languages_menu="matMenu" class="language-menu">
  <button mat-menu-item *ngFor="let language of languages" (click)="selectDirection(language)" class="language-menu-item">
    <mat-icon class="language-check">{{ selectedLanguage.value === language.value ? 'check_circle' : 'language' }}</mat-icon>
    <span>{{ language.name }}</span>
  </button>
</mat-menu>


