<div *ngIf="isLoading" class="loading-overlay">
  <mat-spinner diameter="40"></mat-spinner>
</div>

<form [formGroup]="formGroup" class="dialog-content">

  <!-- Upload Area -->
  <div class="upload-area" (drop)="onFileDrop($event)" (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)" [class.dragover]="isDragging">

      <label class="upload-button">
          <input type="file" accept=".svg,.png,.jpg,.jpeg,.pdf" (change)="onFileSelected($event)" hidden />
          <a mat-raised-button color="primary" class="mat-button-base mat-raised-button">
              Click to Upload
          </a>
      </label>

      <p>or drag and drop</p>
      <small>SVG, PNG, JPG, or PDF (max 3MB)</small>
  </div>
  <mat-error *ngIf="formGroup.get('file')?.hasError('required') && formGroup.get('file')?.touched">
      File is required
  </mat-error>
  <div *ngIf="selectedFile" class="file-info">
      <mat-icon>description</mat-icon>
      {{ selectedFile.name }} ({{ selectedFile.size / 1024 | number:'1.0-0' }} KB)
  </div>

  <br />

  <div class="row">

    <!-- Document Type -->
    <div class="col-6">
      <select-auto-complete 
          *ngIf="loadDocumentTypesFn" 
          [controlName]="'type'" 
          [fnGet]="loadDocumentTypesFn"
          [formGroup]="formGroup" 
          [label]="'Document Type'" 
          [keyToShow]="'name'" 
          [valueKey]="'id'"
          [withNullOption]="false">
      </select-auto-complete>
      <div class="text-danger" *ngIf="formGroup.get('type')?.invalid && formGroup.get('type')?.touched">
        Document Type is required
      </div>
    </div>

    <!-- Nationality -->
    <div class="col-6">
      <select-auto-complete 
          *ngIf="loadNationalitiesFn" 
          [controlName]="'nationality'" 
          [fnGet]="loadNationalitiesFn"
          [formGroup]="formGroup" 
          [label]="'Nationality'" 
          [keyToShow]="'name'" 
          [valueKey]="'id'"
          [withNullOption]="false">
      </select-auto-complete>
      <div class="text-danger" *ngIf="formGroup.get('nationality')?.invalid && formGroup.get('nationality')?.touched">
        Nationality is required
      </div>
    </div>

    <!-- Place Of Issue -->
    <div class="col-6">
      <select-auto-complete 
          *ngIf="loadNationalitiesFn" 
          [controlName]="'placeOfIssue'" 
          [fnGet]="loadNationalitiesFn"
          [formGroup]="formGroup" 
          [label]="'Place Of Issue'" 
          [keyToShow]="'name'" 
          [valueKey]="'id'"
          [withNullOption]="false">
      </select-auto-complete>
      <div class="text-danger" *ngIf="formGroup.get('placeOfIssue')?.invalid && formGroup.get('placeOfIssue')?.touched">
        Place of Issue is required
      </div>
    </div>

    <!-- Number -->
    <div class="full-width col-6">
      <mat-form-field appearance="outline" class="w-100">
          <mat-label>Number</mat-label>
          <input matInput formControlName="idNumber" placeholder="Enter document number..." required />
          <mat-error *ngIf="formGroup.get('idNumber')?.hasError('required') && formGroup.get('idNumber')?.touched">
            Number is required
          </mat-error>
      </mat-form-field>
    </div>

    <!-- Issue Date -->
    <div class="full-width col-6">
      <mat-form-field appearance="outline" class="w-100">
          <mat-label>Issue Date</mat-label>
          <input matInput [matDatepicker]="picker1" formControlName="idIssueDate" placeholder="Select issue date..." required />
          <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
          <mat-datepicker #picker1></mat-datepicker>
          <mat-error *ngIf="formGroup.get('idIssueDate')?.hasError('required') && formGroup.get('idIssueDate')?.touched">
            Issue Date is required
          </mat-error>
      </mat-form-field>
    </div>

    <!-- Expiry Date -->
    <div class="full-width col-6">
      <mat-form-field appearance="outline" class="w-100">
          <mat-label>Expiry Date</mat-label>
          <input matInput [matDatepicker]="picker2" formControlName="expiryDate" placeholder="Select expiry date..." />
          <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
          <mat-datepicker #picker2></mat-datepicker>
      </mat-form-field>
    </div>

    <!-- Primary -->
    <div class="full-width col-6">
      <mat-slide-toggle formControlName="isPrimary"><span class="label-toggle">Primary</span></mat-slide-toggle>
    </div>

    <!-- Active Reminder -->
    <div class="full-width col-6">
      <mat-slide-toggle formControlName="activeReminder"><span class="label-toggle">Active Reminder</span></mat-slide-toggle>
    </div>

  </div>
</form>
