<div class="nexus-entity-container">

    <!-- SECTION 1: Title and Records -->
    <div class="nexus-entity-section">
        <div class="nexus-entity-header">
            <div class="nexus-entity-title">
                <h2>{{ label.LAW_FIRM.ACTIVE_LAW_FIRMS }}</h2>
            </div>
            <button mat-raised-button class="nexus-btn nexus-btn-primary" (click)="onAddNew()">
                <mat-icon>add</mat-icon> {{ label.LAW_FIRM.ADD_LAW_FIRM }}
            </button>
        </div>
    </div>

    <!-- SECTION 2: Filters and Actions -->
    <div class="nexus-entity-section">
        <div class="nexus-entity-filters">
            <div class="nexus-filters-container" [class.has-expanded-filters]="showFilters">
                <div class="nexus-search-field">
                    <mat-form-field appearance="outline">
                        <mat-label>{{ label.COMMON.SEARCH }}</mat-label>
                        <input matInput [(ngModel)]="params.searchBy" (keyup.enter)="search()"
                            [placeholder]="label.PROPERTY.SEARCH_BY_CODE || 'Search by Code'">
                        <mat-icon matSuffix>search</mat-icon>
                    </mat-form-field>
                </div>

                <div class="nexus-toggle-group">
                    <mat-button-toggle-group [(ngModel)]="params.privates" (change)="search()" multiple
                        class="nexus-toggle-compact">
                        <mat-button-toggle [value]="false">{{ label.COMPANY.PUBLIC }}</mat-button-toggle>
                        <mat-button-toggle [value]="true">{{ label.COMPANY.PRIVATE }}</mat-button-toggle>
                    </mat-button-toggle-group>
                </div>


                <div class="nexus-filter-actions">
                    <button mat-stroked-button class="nexus-btn nexus-btn-secondary" (click)="toggleFilters()">
                        <mat-icon>{{ showFilters ? 'close' : 'filter_list' }}</mat-icon>
                        {{ label.COMMON.FILTERS }}
                    </button>
                    <button mat-stroked-button class="nexus-btn nexus-btn-secondary" (click)="exportToExcel()">
                        <mat-icon>download</mat-icon> {{ label.COMPANY.EXPORT }}
                    </button>
                </div>
            </div>

            <!-- Advanced Filters Section -->
            <div class="additional-filters" *ngIf="showFilters">

                <div class="section">
                    <div class="section-header">
                        <h3>{{ label.COMPANY.ADVANCED_FILTER }}</h3>
                    </div>
                    <div class="section-body">

                        <!-- Basic Information -->
                        <div class="row mb-3">

                            <div *ngIf="countryParentId">
                                <dl-select-auto-complete [withNullOption]="true" [controlName]="'countryId'"
                                    [formGroup]="formGroup" [label]="label.COMMON.COUNTRY || 'Property Country'"
                                    [parentId]="countryParentId" (selectEmitter)="onCountryChange($event)">
                                </dl-select-auto-complete>
                            </div>

                        </div>
                        <div class="row mb-3" *ngIf="loadLawFirmExpertiesesFn">
                            <select-auto-complete
                                [controlName]="'lawFirmExpertiseId'" 
                                [fnGet]="loadLawFirmExpertiesesFn" 
                                [formGroup]="formGroup"
                                [withNullOption]="true"
                                [label]="label.LAW_FIRM.LAW_FIRM_EXPERTISE || 'Law Firm Expertise'"
                                [keyToShow]="'expertiseName'" 
                                [valueKey]="'id'"
                                (selectEmitter)="onLawFirmExpertiseChange($event)">
                            </select-auto-complete>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bulk Actions -->
            <div class="nexus-bulk-actions" *ngIf="selectedProperties.length">
                <span class="nexus-bulk-count">{{ selectedProperties.length }} {{ label.COMMON.SELECTED }}</span>
                <div class="nexus-bulk-buttons">
                    <button mat-stroked-button class="nexus-btn nexus-bulk-info" (click)="bulkChangePrivate(false)">
                        <mat-icon>public</mat-icon> {{ label.COMMON.MARK_PUBLIC }}
                    </button>
                    <button mat-stroked-button class="nexus-btn nexus-bulk-info" (click)="bulkChangePrivate(true)">
                        <mat-icon>lock</mat-icon> {{ label.COMMON.MARK_PRIVATE }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SECTION 3: Data Grid -->
    <div class="nexus-entity-section">
        <div class="nexus-entity-data">
            <!-- Loading -->
            <div *ngIf="showLoading" class="nexus-loading">
                <mat-spinner></mat-spinner>
            </div>

            <!-- Table -->
            <div class="nexus-table-container" *ngIf="!showLoading">
                <app-shared-table (rowClick)="onRowClick($event)" (selectionChange)="onSelectionChange($event)"
                    [displayedColumns]="displayColumns" [paginateResult]="data" [action]="actionButtonsTemplate"
                    (onChangePage)="changePage($event)" (onSortChangeEvent)="changeSort($event)">
                </app-shared-table>
            </div>
        </div>
    </div>

    <!-- Row Actions -->
    <ng-template #actionButtonsTemplate let-row>
        <button mat-icon-button [matTooltip]="getAuditTooltip(row)" matTooltipClass="audit-tooltip"
            matTooltipPosition="left" [matTooltipShowDelay]="300" class="audit-info-btn">
            <mat-icon>info</mat-icon>
        </button>
        <button mat-icon-button [matMenuTriggerFor]="menuRow" class="nexus-table-action-btn">
            <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menuRow="matMenu" class="nexus-action-menu">
            <button mat-menu-item class="nexus-menu-item nexus-menu-neutral" (click)="exportToPdf(row.id)">
                <mat-icon class="nexus-icon-print">print</mat-icon> {{ label.COMMON.PRINT }}
            </button>


            <button mat-menu-item (click)="markPublic(row)" class="nexus-menu-item nexus-menu-info">
                <mat-icon class="nexus-icon-public">public</mat-icon> {{ label.COMMON.MARK_PUBLIC }}
            </button>

            <button mat-menu-item (click)="markPrivate(row)" class="nexus-menu-item nexus-menu-neutral">
                <mat-icon class="nexus-icon-private">lock</mat-icon> {{ label.COMMON.MARK_PRIVATE }}
            </button>

            <button mat-menu-item [confirmDelete]="deleteCompany(row)" class="nexus-menu-item nexus-menu-danger">
                <mat-icon class="nexus-icon-delete">delete</mat-icon> {{ label.COMMON.DELETE }}
            </button>

        </mat-menu>
    </ng-template>

</div>